<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Isack Pate</title>
  <link rel="stylesheet" href="assets/style.css" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";
    const firebaseConfig = {
      apiKey: "AIzaSyAflV5MDWOZkWL2a7vSULJAW6UQtQoDShI",
      authDomain: "isack-pate.firebaseapp.com",
      projectId: "isack-pate",
      storageBucket: "isack-pate.firebasestorage.app",
      messagingSenderId: "1062203262615",
      appId: "1:1062203262615:web:2c53b235f75820da670bd2",
      measurementId: "G-MD68N52EM1"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);
    window.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById("addProductForm");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = form.name.value.trim();
        const description = form.description.value.trim();
        const price = form.price.value.trim();
        const file = form.image.files[0];
        if (!file) return alert("Please select an image.");
        const storageRef = ref(storage, 'products/' + Date.now() + "_" + file.name);
        await uploadBytes(storageRef, file);
        const imageUrl = await getDownloadURL(storageRef);
        await addDoc(collection(db, "products"), { name, description, price, imageUrl, created: Date.now() });
        form.reset();
        displayProducts();
      });
      window.displayProducts = async () => {
        const container = document.getElementById("productList");
        container.innerHTML = "";
        const snapshot = await getDocs(collection(db, "products"));
        snapshot.forEach(doc => {
          const p = doc.data();
          const card = document.createElement("div");
          card.className = "product-card";
          card.innerHTML = `<img src="${p.imageUrl}" alt="${p.name}"><h3>${p.name}</h3><p>${p.description}</p><span>${p.price} TZS</span>`;
          container.appendChild(card);
        });
      };
      displayProducts();
    });
    function changeLanguage(sel) { alert("Lugha imebadilishwa kuwa: " + (sel.value === "sw" ? "Kiswahili" : "English")); }
  </script>
</head>
<body>
  <header>
    <img src="assets/images/logo.png" alt="Logo" class="logo">
    <h1>Isack Pate</h1>
    <nav>
      <a href="#home">Home</a>
      <a href="#about">About</a>
      <a href="#services">Our Services</a>
      <select id="languageSwitcher" onchange="changeLanguage(this)">
        <option value="en">English</option>
        <option value="sw">Kiswahili</option>
      </select>
    </nav>
  </header>
  <main>
    <section class="product-form">
      <h2>Ongeza Bidhaa Mpya</h2>
      <form id="addProductForm">
        <input type="text" name="name" placeholder="Jina la Bidhaa" required />
        <textarea name="description" placeholder="Maelezo ya Bidhaa" required></textarea>
        <input type="number" name="price" placeholder="Bei (TZS)" required />
        <input type="file" name="image" accept="image/*" required />
        <button type="submit">Ongeza Bidhaa</button>
      </form>
    </section>
    <section id="productDisplay">
      <h2>Bidhaa Zilizoongezwa</h2>
      <div id="productList" class="product-list"></div>
    </section>
  </main>
</body>
</html>
